# Tema 8 - Geometría, Estructura y Forma

<img src="img/cover-t8.png" alt="Geometría, Estructura y Forma" width="1000"/>

## Índice

- [Tema 8 - Geometría, Estructura y Forma](#tema-8---geometría-estructura-y-forma)
  - [Índice](#índice)
  - [1. Introducción](#1-introducción)
    - [1.1 Aplicaciones de la geometría y estructura en visión por computador](#11-aplicaciones-de-la-geometría-y-estructura-en-visión-por-computador)
  - [2. Calibración geométrica](#2-calibración-geométrica)
    - [2.1 Perspectiva](#21-perspectiva)
      - [Proyección de coordenadas al plano imagen](#proyección-de-coordenadas-al-plano-imagen)
    - [2.2 Transformaciones homogéneas](#22-transformaciones-homogéneas)
      - [Matriz de transformación mundo-cámara](#matriz-de-transformación-mundo-cámara)
      - [Matriz de proyección](#matriz-de-proyección)
      - [Matriz de transformación cámara-píxeles](#matriz-de-transformación-cámara-píxeles)
    - [2.3 Parámetros intrínsecos y extrínsecos](#23-parámetros-intrínsecos-y-extrínsecos)
      - [Parámetros intrínsecos](#parámetros-intrínsecos)
      - [Parámetros extrínsecos](#parámetros-extrínsecos)
        - [Homografía](#homografía)
  - [3. Metrología](#3-metrología)
    - [3.1 Estimación de información 3D](#31-estimación-de-información-3d)
    - [3.2 Métodos para medir alturas](#32-métodos-para-medir-alturas)
    - [3.3 Profundidad monocular](#33-profundidad-monocular)
  - [4. Geometría epipolar](#4-geometría-epipolar)
    - [4.1 Conceptos básicos](#41-conceptos-básicos)
    - [4.2 Matrices esenciales y fundamentales](#42-matrices-esenciales-y-fundamentales)
  - [5. Correspondencia](#5-correspondencia)
    - [5.1 Coincidencia de puntos en imágenes](#51-coincidencia-de-puntos-en-imágenes)
    - [5.2 Triangulación](#52-triangulación)
    - [5.3 Métodos densos](#53-métodos-densos)
  - [6. Estructura desde movimiento (SfM)](#6-estructura-desde-movimiento-sfm)
    - [6.1 Proceso para recuperar la estructura 3D](#61-proceso-para-recuperar-la-estructura-3d)
  - [7. Reconstrucción 3D](#7-reconstrucción-3d)
    - [7.1 Métodos modernos](#71-métodos-modernos)
    - [7.2 Casos de uso](#72-casos-de-uso)
  - [8. Casos prácticos y tecnologías relacionadas](#8-casos-prácticos-y-tecnologías-relacionadas)
  - [9. Conclusión](#9-conclusión)
    - [Resumen de los conceptos clave](#resumen-de-los-conceptos-clave)
    - [Importancia y aplicaciones futuras](#importancia-y-aplicaciones-futuras)
  - [Bibliografía y recursos](#bibliografía-y-recursos)
    - [Referencias clave](#referencias-clave)
    - [Lecturas adicionales y enlaces relevantes](#lecturas-adicionales-y-enlaces-relevantes)


## 1. Introducción

**Contenidos**

- Calibración geométrica
- Metrología
- Geometría epipolar
- Correspondencia
- Estructura desde movimiento (SfM)
- Reconstrucción 3D

### 1.1 Aplicaciones de la geometría y estructura en visión por computador
La geometría y estructura desempeñan un papel fundamental en la visión por computador, ya que permiten analizar las relaciones espaciales entre objetos y la cámara.

**Aplicaciones comunes:**
- **Calibración de cámaras:** Determinar las características intrínsecas y extrínsecas de una cámara para realizar mediciones precisas.
- **Reconstrucción 3D:** Usar múltiples vistas de una escena para generar modelos tridimensionales.
- **Seguimiento de objetos:** Analizar el movimiento de objetos en una secuencia de imágenes.
- **Realidad aumentada:** Integrar elementos virtuales en escenas reales mediante un entendimiento geométrico del entorno.
- **Automoción:** Determinar posiciones 3D de vehículos y peatones para conducción autónoma.

---

## 2. Calibración geométrica

### 2.1 Perspectiva
#### Proyección de coordenadas al plano imagen
La **perspectiva** es el proceso por el cual un punto tridimensional en el espacio es proyectado en un plano bidimensional (imagen) mediante una cámara.

<img src="img/perspectiva.png" alt="Proyección de un punto 3D al plano imagen" width="400"/>

- **Proyección de un punto 3D (X, Y, Z):**
  Para proyectar un punto 3D al plano imagen (x, y), se utiliza una **matriz de proyección**. La relación se puede expresar como:
  
  ```math
  x = \frac{fX}{Z}, \quad y = \frac{fY}{Z}
  ```

  Donde:
  - \(f\): distancia focal de la cámara.
  - \(Z\): profundidad del punto en el espacio.

- **Coordenadas homogéneas:**
  En visión por computador, las coordenadas homogéneas se utilizan para representar puntos en el espacio y simplificar transformaciones geométricas. Un punto 3D \((X, Y, Z)\) se representa como:
  
  ```math
  \mathbf{X_h} = (X, Y, Z, 1)^T
  ```

  Al proyectarlo al plano imagen, se obtiene:
  
  ```math
  \mathbf{x_h} = P \cdot \mathbf{X_h}
  ```

  Donde \(P\) es la matriz de proyección.

  <img src="img/proyeccion-homogenea.png" alt="Proyección de un punto 3D con coordenadas homogéneas" width="400"/>

---

### 2.2 Transformaciones homogéneas

#### Matriz de transformación mundo-cámara
Esta matriz describe cómo transformar puntos desde el sistema de coordenadas del mundo al sistema de coordenadas de la cámara.

- **Estructura de la matriz:**
  ```math
  \mathbf{T} = 
  \begin{bmatrix}
  R & t \\
  0 & 1
  \end{bmatrix}
  ```

  Donde:
  - \(R\): matriz de rotación (3x3), define la orientación de la cámara respecto al mundo.
  - \(t\): vector de traslación (3x1), define la posición de la cámara en el mundo.
  - \(\mathbf{T}\): matriz de transformación homogénea (4x4).

#### Matriz de proyección
La matriz de proyección relaciona puntos en coordenadas del mundo con puntos en el plano imagen. Es una combinación de matrices intrínsecas y extrínsecas:

```math
P = K \cdot [R|t]
```

- \(K\): matriz de parámetros intrínsecos.
- \([R|t]\): transformación mundo-cámara (extrínsecos).

#### Matriz de transformación cámara-píxeles
Convierte las coordenadas de la cámara en coordenadas del plano imagen, incluyendo la escala en píxeles:

```math
K = 
\begin{bmatrix}
f_x & 0 & c_x \\
0 & f_y & c_y \\
0 & 0 & 1
\end{bmatrix}
```

Donde:
- \(f_x, f_y\): escala focal en píxeles (relacionada con la distancia focal física).
- \(c_x, c_y\): coordenadas del centro óptico de la cámara en píxeles.

---

### 2.3 Parámetros intrínsecos y extrínsecos

#### Parámetros intrínsecos
Los parámetros intrínsecos describen las **características internas de la cámara**.

* Punto principal
* Focal
* Escalado
* Píxeles no rectangulares
* Distorsión radial

<img src="img/intrinsecos.png" alt="Parámetros intrínsecos y extrínsecos de una cámara" width="400"/>

- **Punto principal:** Intersección del eje óptico con el plano imagen (\(c_x, c_y\)).
  - Intersección eje principal con plano imagen.
  - Origen en coordenadas de la cámara, \p=(p_x, p_y)\.
  - Coordenadas de la image, origen esquina superior izquierda, \o=(o_x, o_y)\.
  - Suele asumirse el centro de la imagen, \c=(c_x, c_y)\.
  
  <img src="img/punto-principal.png" alt="Punto principal de una cámara" width="400"/>

- **Factor de Escala:** Relación entre el tamaño físico y los píxeles (\(f_x, f_y\)).
  - Mapeo del mundo a unidades de píxeles \m=(m_x, m_y)\. Píxeles por metro.
  
  <img src="img/factor-escala.png" alt="Factor de escala de una cámara" width="400"/>

- **Distorsión radial:** Deformaciones causadas por lentes no ideales.

#### Parámetros extrínsecos
Los parámetros extrínsecos describen la posición y orientación de la cámara en el espacio.

- **Rotación:** Define cómo la cámara está orientada en el espacio.
- **Traslación:** Representa la posición de la cámara respecto al sistema de referencia global.

**Relación entre intrínsecos y extrínsecos:**
La proyección de un punto 3D al plano imagen utiliza tanto parámetros intrínsecos como extrínsecos:

```math
\mathbf{x} \sim K[R|t] \mathbf{X}
```

Donde:
- \(\mathbf{X}\): punto en el espacio 3D.
- \(\mathbf{x}\): punto proyectado en la imagen.
- \(K[R|t]\): combinación de intrínsecos y extrínsecos para formar la matriz de proyección completa.

##### Homografía

La homografía es una transformación proyectiva que mapea puntos de una imagen a otra vista de la misma escena.

- Relaciona puntos sobre un plano en dos imágenes
- Matrix 3x3, nueve valores, pero 8 incógnitas
- Necesarios al menos 4 puntos en ambas imágenes
- Cada par, dos ecuaciones

<img src="img/homografia.png" alt="Homografía entre dos imágenes" width="400"/>
<img src="img/homografia-2.png" alt="Homografía entre dos imágenes" width="400"/>
<img src="img/homografia-soccer.png" alt="Homografía entre dos imágenes" width="400"/>

---

## 3. Metrología
### 3.1 Estimación de información 3D
- Perspectiva y puntos de fuga
- Razón anarmónica o cross-ratio

### 3.2 Métodos para medir alturas
- Relación con puntos de fuga y coordenadas

### 3.3 Profundidad monocular
- Métodos supervisados y no supervisados

## 4. Geometría epipolar
### 4.1 Conceptos básicos
- Epipolos, líneas y planos epipolares
- Restricción epipolar en cámaras calibradas y no calibradas

### 4.2 Matrices esenciales y fundamentales
- Propiedades y estimación

## 5. Correspondencia
### 5.1 Coincidencia de puntos en imágenes
- Algoritmos de encaje y rectificación

### 5.2 Triangulación
- Recuperación de profundidad a partir de disparidad

### 5.3 Métodos densos
- Problemas y soluciones con mapas de disparidad

## 6. Estructura desde movimiento (SfM)
### 6.1 Proceso para recuperar la estructura 3D
- Detección de puntos clave
- Estimación de movimiento y estructura
- Refinamiento mediante RANSAC y filtros

## 7. Reconstrucción 3D
### 7.1 Métodos modernos
- Radiance Fields (NeRFs) y Gaussian Splatting

### 7.2 Casos de uso
- Generación de escenas 3D
- Modelado de entornos dinámicos

## 8. Casos prácticos y tecnologías relacionadas
- Realidad aumentada y calibración
- SLAM (Simultaneous Localization and Mapping)
- Usos en automoción y robótica

## 9. Conclusión
### Resumen de los conceptos clave
### Importancia y aplicaciones futuras

## Bibliografía y recursos
### Referencias clave
### Lecturas adicionales y enlaces relevantes
